- step:
    name: preprocess
    image: tensorflow/tensorflow:1.13.1-gpu-py3
    command: preprocess.sh
    inputs:
        - name: training-set
        - name: validation-set

- step:
    name: generate-tfrecords
    image: tensorflow/tensorflow:1.13.1-py3
    command: preprocess.sh
    inputs:
        - name: training-set
          default: s3://futurice-futurace/03_train_val_test_splits/train.tar.gz
        - name: validation-set
          default: s3://futurice-futurace/03_train_val_test_splits/val.tar.gz

- step:
    name: training
    image: tensorflow/tensorflow:1.13.1-gpu-py3
    command: python train.py
    inputs:
        - name: training-set
        - name: validation-set

- step:
    name: train-with-tf-records
    image: tensorflow/tensorflow:1.13.1-gpu-py3
    command: python 03_train_with_tfrecords.py
    parameters:
        - name: batch-size
          type: integer
          default: 256
        - name: epochs
          type: integer
          default: 100
        - name: min-delta
          type: float
          default: 0.05
        - name: patience
          type: integer
          default: 3
    inputs:
        - name: training-set
          default: s3://futurice-futurace/data/01DT7/01DT7NWSQ44ZF5Y29T0GYZ9H0G/output-48/train.tfrecord
        - name: validation-set
          default: s3://futurice-futurace/data/01DT7/01DT7NWSQ44ZF5Y29T0GYZ9H0G/output-48/val.tfrecord
